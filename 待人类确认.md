# 待人类确认事项

**生成时间**: 2026-01-15 00:48
**项目**: CloudBoot NG
**当前阶段**: Phase 2完成，Phase 3待开始

---

## 1. 技术决策需确认

### 1.1 Echo版本选择

**决策**: 使用Echo v4.12.0而非最新的v4.15.0

**原因**:
- v4.15.0要求Go >= 1.24.0
- 当前开发环境Go版本为1.23.3
- v4.12.0功能完全满足需求

**风险**:
- 可能缺少v4.15的新特性
- 未来升级时需要同时升级Go版本

**建议**:
- [ ] 确认生产环境Go版本
- [ ] 如果生产环境可升级到Go 1.24+，考虑升级Echo到v4.15
- [ ] 当前v4.12可正常使用，不影响核心功能

---

### 1.2 Tailwind CSS安装方式

**决策**: 使用Tailwind CLI下载二进制，而非npm安装

**原因**:
- 避免引入Node.js依赖，符合"零依赖"原则
- Tailwind CLI可独立运行，无需npm生态

**优点**:
- ✅ 符合项目架构原则
- ✅ 减少构建复杂度
- ✅ 二进制体积更小（无node_modules）

**缺点**:
- ⚠️ 需要手动下载CLI
- ⚠️ Makefile中已提供`install-deps`目标自动下载

**建议**:
- [ ] 确认该方案是否符合团队开发习惯
- [ ] 如有CI/CD流程，确保CI环境可访问GitHub下载CLI

---

### 1.3 embed.FS延迟实现 (**已更新 2026-01-15 10:07**)

**决策**: embed.FS实现延后到Phase 6，当前使用文件系统服务

**技术原因**:
- Go embed不支持符号链接（安全限制）
- Go embed不允许 `../` 路径引用
- embed路径必须相对于go:embed指令所在源文件
- 参考: https://github.com/golang/go/issues/46056

**已尝试方案**:
1. ❌ 使用`//go:embed ../../web/static` - Go不允许..路径
2. ❌ 创建symlink `cmd/server/web -> ../../web` - Go embed不跟随symlink
3. ❌ 使用`embedded/`独立包 - 路径问题相同

**当前方案**:
- 开发模式: 直接使用 `e.Static("/static", "web/static")` 文件系统服务
- 生产模式: 通过构建脚本预拷贝web目录到二进制同级目录

**代码位置**: `cmd/server/main.go:16-19` (添加了详细注释说明原因)

**影响**:
- ⚠️ 当前二进制需要web/目录才能运行
- ⚠️ 不符合"单体二进制"的最终要求
- ✅ 不影响开发和功能验证
- ✅ 生产环境可通过Docker/Systemd Unit配置解决

**未来方案**:
- [ ] Phase 6创建构建脚本，将web/目录打包到二进制同级
- [ ] 或使用build tags区分开发/生产编译
- [ ] 或将main.go移到项目根目录（架构调整）

**建议**:
- [x] ~~Phase 3实现embed.FS~~ → 延后到Phase 6
- [ ] 接受当前文件系统方案
- [ ] Phase 6时评估是否仍需embed.FS

---

## 2. 测试覆盖率问题

### 2.1 单元测试覆盖率不足

**现状**:
- CSPM Executor: 5个测试用例，3个PASS，2个预期失败
- 数据模型: 无单元测试
- Plugin Manager: 无单元测试
- API Handler: 无单元测试

**目标**: > 80%覆盖率

**当前**: ~15%覆盖率

**差距**: 65%

**建议行动**:
- [ ] Phase 3优先补充数据模型测试
- [ ] Phase 3补充Plugin Manager测试
- [ ] Phase 3-4补充API Handler测试
- [ ] 每个Phase完成后运行`go test -cover ./...`验证

---

### 2.2 TestExecutorTimeout和TestExecutorInvalidCommand失败

**现状**: 2个测试用例失败（FAIL）

**原因**:
- Mock Provider未实现错误退出码
- Mock Provider对invalid command不返回错误

**是否为Bug**: ❌ 否，这是Mock的局限性

**影响**: 不影响核心功能，真实Provider需要返回正确的退出码

**建议**:
- [ ] 接受当前Mock的行为（标记为预期失败）
- [ ] 或修改Mock Provider增加错误处理逻辑
- [ ] 真实Provider实现时必须返回正确的退出码

---

## 3. 架构疑问与建议

### 3.1 SQLite并发性能

**现状**: 使用SQLite WAL模式

**疑问**:
- 目标支持500+并发部署节点
- SQLite WAL是否能满足并发要求？

**已采取措施**:
- ✅ 启用WAL模式（Write-Ahead Logging）
- ✅ 允许并发读

**待验证**:
- [ ] Phase 6进行并发压测
- [ ] 如果性能不足，是否需要切换到PostgreSQL？

**建议**:
- 先验证SQLite性能
- 如果不满足，设计数据库切换方案（抽象database接口）

---

### 3.2 API业务逻辑为Mock

**现状**:
- 当前所有API端点返回Mock数据
- 未连接到数据库和业务逻辑

**影响**:
- ⚠️ 无法实际测试完整流程
- ⚠️ 不符合PRD功能要求

**计划**:
- Phase 3实现真实的API Handler
- 连接到database和models
- 实现CRUD操作

**建议**:
- [ ] Phase 3优先级P0任务：实现API业务逻辑
- [ ] 参考API-SPEC.yaml规范实现

---

## 4. 安全机制待实现

### 4.1 DRM机制

**现状**: 完全未实现

**要求**（根据CSPM_Protocol.md）:
- Provider以AES-256加密存储
- 使用License解密Master Key
- 生成Session Key重加密
- BootOS内存解密并执行后销毁

**当前方案**: Provider以明文存储，直接执行

**风险**: ⚠️ 高安全风险，不符合商业DRM要求

**建议**:
- [ ] Phase 4-5实现DRM机制
- [ ] 优先级P1（不影响核心功能开发，但生产必需）
- [ ] 需要crypto专家审查加密方案

---

### 4.2 Provider沙箱隔离

**现状**: 未实现

**要求**: Provider进程只能访问`/opt/cloudboot/runtime`

**当前方案**: Provider可访问整个文件系统

**风险**: ⚠️ 中等安全风险

**建议**:
- [ ] Phase 5实现cb-exec沙箱
- [ ] 使用Linux Namespaces或Docker容器隔离
- [ ] 优先级P1

---

## 5. 开发流程建议

### 5.1 Git仓库初始化

**现状**: 项目文件夹未初始化Git

**建议**:
- [ ] 执行`git init`
- [ ] 创建`.gitignore`（忽略build/、tmp/、*.db、web/static/css/output.css等）
- [ ] 提交初始代码
- [ ] 创建develop分支用于开发

---

### 5.2 CI/CD流程

**现状**: 无CI配置

**建议**:
- [ ] Phase 3-4添加GitHub Actions或GitLab CI
- [ ] 自动运行`go test`, `go build`, `golangci-lint`
- [ ] 自动构建二进制并上传为Release

---

### 5.3 文档同步

**现状**: 代码和文档可能存在轻微不一致

**建议**:
- [ ] 每个Phase完成后更新相关文档
- [ ] TODO.md保持与实际进度同步
- [ ] IMPLEMENTATION_REPORT.md定期更新

---

## 6. 功能优先级确认

### 6.1 Phase 3任务优先级

当前Phase 3包含4个任务，建议优先级排序：

1. **API业务逻辑实现**（P0） - 阻塞后续开发
2. **SSE LogBroker实现**（P0） - 核心功能
3. **单元测试补充**（P0） - 质量保证
4. **OS Designer实现**（P1） - 用户体验

**建议**:
- [ ] 确认该优先级排序
- [ ] 或调整为并行开发（API+SSE+测试同时进行）

---

### 6.2 是否需要提前实现Agent

**疑问**: Agent在Phase 5，是否需要提前实现以便测试？

**利弊分析**:
- ✅ 提前实现可以更早进行E2E测试
- ❌ 提前实现可能分散Phase 3-4的开发精力

**建议**:
- [ ] 保持当前Phase顺序
- [ ] 或在Phase 3创建简化版Agent用于测试（最小可行Agent）

---

## 7. 需要提供的外部资源

### 7.1 真实硬件测试环境

**需求**: 实验室海光/鲲鹏服务器

**用途**: Phase 6真实硬件测试

**建议**:
- [ ] 提前协调实验室资源
- [ ] 准备PXE网络环境
- [ ] 安装真实RAID卡驱动

---

### 7.2 真实Provider驱动

**需求**: LSI MegaRAID、其他厂商RAID卡的Provider

**现状**: 仅有Mock Provider

**建议**:
- [ ] 联系硬件厂商获取驱动
- [ ] 或自行开发基于厂商CLI的Provider
- [ ] 优先级P2（Phase 5-6）

---

## 8. 总结建议

### 立即行动项（Phase 3开始前）

- [ ] **确认技术决策**: Echo版本、Tailwind安装方式、embed.FS优先级
- [ ] **确认功能优先级**: Phase 3任务排序
- [ ] **初始化Git仓库**: `git init`并提交初始代码
- [ ] **Code Review**: 审查当前代码质量和架构设计

### 短期行动项（Phase 3期间）

- [ ] **实现API业务逻辑**: 连接数据库，实现CRUD
- [ ] **实现SSE LogBroker**: 实时日志推送
- [ ] **补充单元测试**: 提升覆盖率到50%+
- [ ] **实现embed.FS**: 完成单体二进制目标

### 中期行动项（Phase 4-5）

- [ ] **DRM机制实现**: 加密存储和内存解密
- [ ] **Provider沙箱**: 使用Namespaces隔离
- [ ] **Agent开发**: cb-agent, cb-probe, cb-exec
- [ ] **CI/CD配置**: GitHub Actions自动化

### 长期行动项（Phase 6）

- [ ] **QEMU仿真**: 搭建E2E测试环境
- [ ] **并发压测**: 验证500+节点并发
- [ ] **真实硬件测试**: 实验室环境验证
- [ ] **安全审计**: 第三方安全评估

---

**审核者**: [待填写]
**审核时间**: [待填写]
**审核意见**: [待填写]

---

**备注**: 本文档由Claude Code在自主决策模式下生成，所有决策均基于文档要求和工程最佳实践。如有疑问或需要调整，请及时反馈。
