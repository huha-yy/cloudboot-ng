è¿™æ˜¯ **è¡ŒåŠ¨ 2ï¼šæ ¸å¿ƒè„å™¨ (The Core Organs)** çš„å…·ä½“ä»»åŠ¡æ‰§è¡Œè§„æ ¼ä¹¦ã€‚

è¯·å°†ä»¥ä¸‹å†…å®¹ä¿å­˜ä¸º `TASK_02_Core_Organs.md`ã€‚è¿™æ˜¯æ‚¨å‘ç»™ Claude Code çš„ç¬¬äºŒé“æˆ˜æœ¯æŒ‡ä»¤ï¼Œä¹Ÿæ˜¯**æŒ‚æœºå¼€å‘æ¨¡å¼**çš„æ ¸å¿ƒä¾æ®ã€‚

---

# TASK_02_Core_Organs.md
**ä»»åŠ¡åç§°**ï¼šè¡ŒåŠ¨ 2ï¼šæ ¸å¿ƒè„å™¨ (æ•°æ®å±‚ä¸Ž CSPM å¼•æ“Ž)  
**æ‰§è¡Œæ¨¡å¼**ï¼šðŸŒ™ å…¨è‡ªåŠ¨æŒ‚æœº (Autonomous)  
**å‰ç½®ä¾èµ–**ï¼šå·²å®Œæˆ `TASK_01`ï¼Œä¸”å·²ç†Ÿè¯» `DATA_Schema.md`, `CSPM_Protocol.md`ã€‚

---

## 1. ä»»åŠ¡ç›®æ ‡ (Objective)
æž„å»º Cloudboot NG çš„åŽç«¯é€»è¾‘æ ¸å¿ƒã€‚å®žçŽ°æ•°æ®æŒä¹…åŒ–å±‚ï¼Œå¹¶è·‘é€šâ€œä¸»ç¨‹åºè°ƒç”¨æ’ä»¶â€çš„ CSPM æ ¸å¿ƒæœºåˆ¶ã€‚

**äº¤ä»˜ç‰©**ï¼š

1. **æ•°æ®å±‚**ï¼šå®Œæ•´çš„ Gorm Model å®šä¹‰ä¸Ž SQLite åˆå§‹åŒ–ä»£ç ã€‚
2. **CSPM å¼•æ“Ž**ï¼šèƒ½å¤Ÿå‘çŽ°ã€åŠ è½½ã€æ‰§è¡Œ Provider çš„ Go åŒ…ã€‚
3. **Mock Provider**ï¼šä¸€ä¸ªç¬¦åˆåè®®æ ‡å‡†çš„æ¨¡æ‹Ÿé©±åŠ¨äºŒè¿›åˆ¶æ–‡ä»¶ã€‚
4. **å…¨é‡æµ‹è¯•**ï¼š`go test ./...` å¿…é¡»å…¨ç»¿ï¼Œè¯æ˜Žé€»è¾‘é—­çŽ¯ã€‚

---

## 2. è¯¦ç»†æ‰§è¡Œæ­¥éª¤ (Execution Steps)
### Step 1: æ•°æ®å±‚å®žçŽ° (Data Layer)
+ **ä½ç½®**ï¼š`internal/models/` & `internal/pkg/db/`
+ **ä¾èµ–**ï¼š`gorm.io/gorm`, `gorm.io/driver/sqlite`ã€‚
+ **ä»»åŠ¡**ï¼š
    - åˆå§‹åŒ– SQLite è¿žæŽ¥ï¼Œ**å¿…é¡»å¼€å¯ WAL æ¨¡å¼**ä»¥æé«˜å¹¶å‘æ€§èƒ½ã€‚
    - æ ¹æ® `DATA_Schema.md`ï¼Œç²¾ç¡®å®žçŽ°ä»¥ä¸‹ Structï¼š
        * `Machine` (æ³¨æ„ HardwareSpec å­—æ®µéœ€å®žçŽ° `gorm:serializer:json`)
        * `Job` (ä»»åŠ¡æµæ°´çº¿)
        * `License` (æŽˆæƒä¿¡æ¯)
        * `OSProfile` (é…ç½®æ¨¡æ¿)
    - å®žçŽ° `AutoMigrate` é€»è¾‘ï¼Œç¡®ä¿æœåŠ¡å¯åŠ¨æ—¶è‡ªåŠ¨å»ºè¡¨ã€‚

### Step 2: CSPM æ ¸å¿ƒå¼•æ“Ž (CSPM Engine)
+ **ä½ç½®**ï¼š`internal/core/cspm/`
+ **æ ¸å¿ƒé€»è¾‘**ï¼š
    - **Types**: æ ¹æ® `CSPM_Protocol.md` å®šä¹‰ `ProviderRequest`, `ProviderResponse`, `LogEntry` ç»“æž„ä½“ã€‚
    - **PluginManager**:
        * æ‰«æ `./bin/providers` (å¼€å‘çŽ¯å¢ƒ) æˆ– `/opt/cloudboot/runtime/bin` (ç”Ÿäº§çŽ¯å¢ƒ)ã€‚
        * ç»´æŠ¤ä¸€ä¸ª `map[string]ProviderInfo` çš„æ³¨å†Œè¡¨ã€‚
    - **Executor**:
        * å®žçŽ° `func Execute(ctx, providerPath, req)`ã€‚
        * ä½¿ç”¨ `os/exec` å¯åŠ¨å­è¿›ç¨‹ã€‚
        * é€šè¿‡ **Stdin** å†™å…¥ JSON è¯·æ±‚ã€‚
        * é€šè¿‡ **Stdout** è¯»å– JSON å“åº”ã€‚
        * é€šè¿‡ **Stderr** å®žæ—¶è¯»å–æ—¥å¿—æµï¼Œå¹¶è§£æžä¸º `LogEntry` å¯¹è±¡ï¼Œå†™å…¥ Go Channelã€‚

### Step 3: æ¨¡æ‹Ÿå¢¨ç›’å¼€å‘ (The Mock Provider)
+ **ä½ç½®**ï¼š`cmd/provider-mock/main.go`
+ **ä»»åŠ¡**ï¼šç¼–å†™ä¸€ä¸ªç‹¬ç«‹çš„ Go ç¨‹åºï¼Œç”¨äºŽéª—è¿‡ Executorã€‚
+ **é€»è¾‘**ï¼š
    - è¯»å– Stdin JSONã€‚
    - å¦‚æžœæ˜¯ `probe`ï¼šè¿”å›žä¸€ä¸ªå›ºå®šçš„æ¨¡æ‹Ÿç¡¬ä»¶æŒ‡çº¹ï¼ˆåŒ…å«å‡æƒ³çš„ LSI RAID å¡ï¼‰ã€‚
    - å¦‚æžœæ˜¯ `apply`ï¼š
        * æ¨¡æ‹Ÿè€—æ—¶æ“ä½œï¼ˆ`time.Sleep`ï¼‰ã€‚
        * å‘ Stderr æ‰“å° 5-10 æ¡ç»“æž„åŒ–æ—¥å¿—ï¼ˆå¦‚ `{"level":"info", "msg":"Initializing..."}`ï¼‰ã€‚
        * å‘ Stdout æ‰“å° `{"status":"success", "changed":true}`ã€‚
+ **æž„å»º**ï¼šåœ¨ `Makefile` ä¸­æ·»åŠ  `build-mock`ï¼Œå°†å…¶ç¼–è¯‘åˆ° `bin/providers/provider-mock`ã€‚

### Step 4: å•å…ƒæµ‹è¯•é—­çŽ¯ (The Safety Net)
+ **ä½ç½®**ï¼š`internal/core/cspm/executor_test.go`
+ **ä»»åŠ¡**ï¼šç¼–å†™é›†æˆæµ‹è¯•ã€‚
    1. æµ‹è¯•ä»£ç è‡ªåŠ¨ç¼–è¯‘ `provider-mock`ã€‚
    2. æµ‹è¯•ä»£ç è°ƒç”¨ `cspm.Execute` æŒ‡å‘è¿™ä¸ª Mock æ–‡ä»¶ã€‚
    3. **æ–­è¨€**ï¼š
        * èƒ½æ”¶åˆ° Stdout çš„æˆåŠŸå“åº”ã€‚
        * èƒ½é€šè¿‡ Channel æ”¶åˆ°è‡³å°‘ 3 æ¡æ¥è‡ª Stderr çš„æ—¥å¿—ã€‚
        * é”™è¯¯å¤„ç†ï¼šæµ‹è¯• Provider å´©æºƒæˆ–è¶…æ—¶çš„æƒ…å†µï¼ŒExecutor æ˜¯å¦èƒ½æ­£ç¡®æŠ¥é”™ã€‚

---

## 3. éªŒæ”¶æ ‡å‡† (Acceptance Criteria)
å½“æ¬¡æ—¥æ¸…æ™¨æˆ‘ï¼ˆäººç±»æŒ‡æŒ¥å®˜ï¼‰æ£€æŸ¥ä»£ç æ—¶ï¼Œæ‰§è¡Œ `make test` å¿…é¡»æ»¡è¶³ï¼š

1. **PASS**: æ‰€æœ‰æ•°æ®åº“ CRUD æµ‹è¯•é€šè¿‡ã€‚
2. **PASS**: CSPM è°ƒç”¨ Mock Provider æµç¨‹é€šè¿‡ã€‚
3. **æ—¥å¿—æ¸…æ´—**ï¼šæµ‹è¯•è¾“å‡ºä¸­ï¼Œå¿…é¡»çœ‹åˆ° Mock Provider å‘å‡ºçš„ JSON æ—¥å¿—è¢«æ­£ç¡®è§£æžæˆäº† Go Structï¼Œè€Œä¸æ˜¯åŽŸå§‹å­—ç¬¦ä¸²ã€‚

---

### **ç»™ Claude çš„å¯åŠ¨ Prompt**ï¼š
_(è¯·å¤åˆ¶ä»¥ä¸‹æŒ‡ä»¤ç»™ Claude)_

> "Claude, æˆ‘ä»¬è¿›å…¥ **è¡ŒåŠ¨ 2ï¼šæ ¸å¿ƒè„å™¨**ã€‚  
è¿™æ˜¯ä¸€ä¸ª **å…¨è‡ªåŠ¨æŒ‚æœº (Autonomous)** ä»»åŠ¡ã€‚ä½ çš„ç›®æ ‡æ˜¯å»ºç«‹æ•°æ®åº•å±‚å’Œæ’ä»¶å¼•æ“Žï¼Œå¹¶é€šè¿‡å•å…ƒæµ‹è¯•éªŒè¯ã€‚
>
> è¯·è¯»å– `TASK_02_Core_Organs.md`ï¼Œå¹¶ä¸¥æ ¼ä¾æ® `DATA_Schema.md` å’Œ `CSPM_Protocol.md` æ‰§è¡Œã€‚
>
> **æ‰§è¡Œé¡ºåºå»ºè®®**ï¼š
>
> 1. å…ˆå†™ Gorm Model å’Œ DB Initã€‚
> 2. å†å†™ `cmd/provider-mock` å¹¶ç¡®ä¿èƒ½ç¼–è¯‘é€šè¿‡ã€‚
> 3. ç„¶åŽå®žçŽ° CSPM çš„ Executor é€»è¾‘ã€‚
> 4. æœ€åŽç¼–å†™ `_test.go` å°†ä¸¤è€…ä¸²èµ·æ¥ã€‚
>
> **å…³é”®çº¦æŸ**ï¼š
>
> + å¿…é¡»ä½¿ç”¨ TDD æ¨¡å¼ã€‚
> + é‡åˆ°ä»»ä½•é€»è¾‘é”™è¯¯ï¼Œè¯·è‡ªæˆ‘ä¿®æ­£ï¼Œä¸è¦ä¸­æ–­ï¼Œç›´åˆ° `go test` é€šè¿‡ã€‚
> + ç¡®ä¿ SQLite å¼€å¯äº† WAL æ¨¡å¼ã€‚
>
> çŽ°åœ¨å¼€å§‹æ‰§è¡Œã€‚"
>

