{{/* Terminal Component */}}

{{/* Terminal Window */}}
{{define "terminal"}}
<div class="terminal {{.class}}">
    {{if .showHeader}}
    <div class="flex items-center gap-2 px-3 py-2 border-b border-slate-800">
        <div class="flex gap-1.5">
            <div class="w-3 h-3 rounded-full bg-rose-500"></div>
            <div class="w-3 h-3 rounded-full bg-amber-500"></div>
            <div class="w-3 h-3 rounded-full bg-emerald-500"></div>
        </div>
        {{if .title}}
        <span class="text-xs text-slate-400 ml-2">{{.title}}</span>
        {{end}}
    </div>
    {{end}}
    <div class="p-4 font-mono text-sm {{if .maxHeight}}{{.maxHeight}}{{else}}max-h-96{{end}} overflow-y-auto">
        {{.content}}
    </div>
</div>
{{end}}

{{/* Terminal Line */}}
{{define "terminal-line"}}
<div class="{{if .class}}{{.class}}{{end}}">
    {{if .prompt}}
    <span class="text-emerald-500">{{.prompt}}</span>
    {{end}}
    <span class="{{if .color}}{{.color}}{{else}}text-slate-300{{end}}">{{.text}}</span>
</div>
{{end}}

{{/* Terminal with Live Stream (SSE) */}}
{{define "terminal-stream"}}
<div class="terminal {{.class}}"
     x-data="{logs: [], isStreaming: false}"
     x-init="
        const eventSource = new EventSource('{{.endpoint}}');
        isStreaming = true;
        eventSource.onmessage = (event) => {
            const log = JSON.parse(event.data);
            logs.push(log);
            $nextTick(() => {
                $el.querySelector('.terminal-content').scrollTop = $el.querySelector('.terminal-content').scrollHeight;
            });
        };
        eventSource.onerror = () => {
            isStreaming = false;
            eventSource.close();
        };
     ">
    <div class="flex items-center gap-2 px-3 py-2 border-b border-slate-800">
        <div class="flex gap-1.5">
            <div class="w-3 h-3 rounded-full bg-rose-500"></div>
            <div class="w-3 h-3 rounded-full bg-amber-500"></div>
            <div class="w-3 h-3 rounded-full bg-emerald-500"></div>
        </div>
        <span class="text-xs text-slate-400 ml-2">{{if .title}}{{.title}}{{else}}Live Logs{{end}}</span>
        <div x-show="isStreaming" class="ml-auto">
            <span class="dot-pulse"></span>
            <span class="text-xs text-emerald-500 ml-2">Streaming</span>
        </div>
    </div>
    <div class="terminal-content p-4 font-mono text-sm max-h-96 overflow-y-auto">
        <template x-for="log in logs" :key="log.ts">
            <div class="terminal-line">
                <span class="text-slate-500" x-text="new Date(log.ts).toLocaleTimeString()"></span>
                <span class="ml-2"
                      :class="{
                        'text-rose-500': log.level === 'ERROR',
                        'text-amber-500': log.level === 'WARN',
                        'text-emerald-500': log.level === 'INFO',
                        'text-slate-500': log.level === 'DEBUG'
                      }"
                      x-text="`[${log.level}]`"></span>
                <span class="text-slate-300 ml-2" x-text="log.msg"></span>
            </div>
        </template>
        <div x-show="logs.length === 0" class="text-slate-500">
            Waiting for logs...
        </div>
    </div>
</div>
{{end}}
