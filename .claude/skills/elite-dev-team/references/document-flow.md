# 文档驱动协作规范

## 并行化流程设计

### 阶段视图（含并行任务）

```
阶段1: 需求定义                    阶段2: 设计                         阶段3: 开发                    阶段4: 验证                  阶段5: 发布
┌─────────────────┐          ┌─────────────────────────┐         ┌─────────────────────┐      ┌─────────────────┐       ┌──────────────┐
│                 │          │                         │         │                     │      │                 │       │              │
│   产品经理      │          │  架构师    技术负责人    │         │  前端    后端       │      │   测试工程师    │       │   DevOps     │
│   ────────      │          │  ─────    ──────────   │         │  ───    ───        │      │   ──────────    │       │   ──────     │
│                 │          │                         │         │                     │      │                 │       │              │
│   PRD.md ──────────────────▶ ARCHITECTURE.md        │         │   ▼      ▼         │      │                 │       │              │
│                 │          │       │                 │         │                     │      │                 │       │              │
│                 │          │       ├──▶ API-SPEC ───────────────▶ 并行开发          │      │                 │       │              │
│                 │          │       │                 │         │   │      │         │      │                 │       │              │
│                 │          │       └──▶ TASK-BREAKDOWN ─────────▶ │      │         │      │                 │       │              │
│                 │          │                         │         │   │      │         │      │                 │       │              │
│                 │          │                         │         │   ▼      ▼         │      │                 │       │              │
│   PRD.md ─────────────────────────────────────────────────────────────────────────────────▶ TEST-PLAN.md    │       │              │
│                 │          │                         │         │   IMPL文档 ────────────────▶ 测试执行       │       │              │
│                 │          │                         │         │                     │      │   │            │       │              │
│                 │          │                         │         │   ◀── Bug修复回环 ──────────┘   │            │       │              │
│                 │          │                         │         │                     │      │   │            │       │              │
│                 │          │                         │         │                     │      │   ▼            │       │              │
│                 │          │                         │         │                     │      │ TEST-REPORT ──────────▶ DEPLOYMENT   │
│                 │          │                         │         │                     │      │                 │       │   │          │
│                 │          │                         │         │                     │      │                 │       │   ▼          │
│   ◀───────────────────────────────────────────────────────────────────────────────────────── 产品验收 ◀─────────── 部署完成       │
│                 │          │                         │         │                     │      │                 │       │              │
└─────────────────┘          └─────────────────────────┘         └─────────────────────┘      └─────────────────┘       └──────────────┘
```

## 可并行任务矩阵

| 阶段 | 并行任务组 | 前置条件 | 同步点 |
|------|------------|----------|--------|
| 设计 | 架构设计 ∥ 任务分解 | PRD已批准 | API规范完成 |
| 设计 | API规范 ∥ 数据库设计 | 架构设计完成 | 设计评审 |
| 开发 | **前端开发 ∥ 后端开发** | API规范已批准 | 联调测试 |
| 开发 | 开发实现 ∥ 测试计划编写 | 任务分解完成 | 代码提交 |
| 测试 | 单元测试(开发) ∥ 集成测试(QA) | 代码完成 | 测试报告 |
| 发布 | 部署 ∥ 运维文档 | 测试通过 | 发布完成 |

## 反馈回环设计

### 回环1: 代码审查回环

```
开发提交PR → 技术负责人审查 → 通过? 
                              ├─ 是 → 合并
                              └─ 否 → 返回修改 → 重新提交
```

**文档接口**：
```markdown
## 代码审查反馈 (PR-REVIEW.md)

### PR信息
- PR编号: #xxx
- 提交者: [开发角色]
- 审查者: 技术负责人

### 审查结果: [通过/需修改]

### 需修改项
| 文件 | 行号 | 类型 | 说明 | 状态 |
|------|------|------|------|------|
|      |      | Bug/建议 |   | 待修复 |

### 修复后重新审查
- [ ] 所有问题已修复
- [ ] 重新审查通过
```

### 回环2: Bug修复回环 ⭐ 核心回环

```
测试发现Bug → 提交Bug报告 → 开发修复 → 提交修复 → 测试验证 → 通过?
                                                            ├─ 是 → 关闭Bug
                                                            └─ 否 → 返回修复
```

**文档接口**：
```markdown
## Bug修复跟踪 (BUG-TRACKING.md)

### Bug列表
| Bug ID | 标题 | 严重程度 | 状态 | 指派给 | 修复版本 |
|--------|------|----------|------|--------|----------|
| BUG-001 |     | Critical | 修复中 | 后端 | |

### Bug详情: BUG-001

#### 报告信息
- 报告人: 测试工程师
- 发现时间: 
- 环境: QA

#### 问题描述
[描述]

#### 修复记录
| 时间 | 操作 | 操作人 | 说明 |
|------|------|--------|------|
| | 创建 | 测试 | |
| | 修复 | 开发 | PR#xxx |
| | 验证 | 测试 | 通过/不通过 |

#### 当前状态: [新建/修复中/待验证/已关闭/重新打开]
```

### 回环3: 部署回滚回环

```
部署执行 → 健康检查 → 通过?
                    ├─ 是 → 发布成功
                    └─ 否 → 回滚 → 问题分析 → 修复 → 重新部署
```

**文档接口**：
```markdown
## 部署回滚记录 (ROLLBACK.md)

### 回滚信息
- 版本: vX.X.X → vX.X.Y (回滚到)
- 时间:
- 执行人: DevOps

### 回滚原因
[原因描述]

### 问题分析
- 根因: 
- 影响范围:

### 修复计划
| 任务 | 负责人 | 预计完成 |
|------|--------|----------|
|      |        |          |

### 重新发布计划
- 预计时间:
- 前置条件:
```

### 回环4: 产品验收回环

```
发布完成 → 产品验收 → 通过?
                    ├─ 是 → 项目完成
                    └─ 否 → 创建优化需求 → 回到需求阶段
```

**文档接口**：
```markdown
## 产品验收记录 (UAT-RESULT.md)

### 验收信息
- 版本: vX.X.X
- 验收人: 产品经理
- 时间:

### 验收结果: [通过/有条件通过/不通过]

### 验收项检查
| PRD功能ID | 功能名称 | 验收结果 | 备注 |
|-----------|----------|----------|------|
| F001 |  | ✅通过 | |
| F002 |  | ⚠️有问题 | 需优化 |

### 后续行动
| 问题 | 类型 | 处理方式 | 优先级 |
|------|------|----------|--------|
|      | Bug/优化 | 本期修复/下期 | |
```

## 完整流程图（含回环）

```
┌──────────────────────────────────────────────────────────────────────────────────────────┐
│                                    完整开发流程                                           │
└──────────────────────────────────────────────────────────────────────────────────────────┘

                                    需求变更
                                       ▲
                                       │
┌─────────┐    ┌─────────┐    ┌────────┴───┐    ┌─────────────────────┐    ┌─────────┐
│ 需求定义 │───▶│ 架构设计 │───▶│  任务分解   │───▶│     开发实现        │───▶│  测试   │
│         │    │         │    │            │    │  ┌─────┐  ┌─────┐  │    │         │
│ PRD.md  │    │ARCH.md  │    │TASK.md     │    │  │前端 │∥│后端 │  │    │TEST.md  │
└─────────┘    │API.yaml │    └────────────┘    │  └──┬──┘  └──┬──┘  │    └────┬────┘
               └─────────┘                      │     │        │     │         │
                                                │     ▼        ▼     │         │
                                                │  ┌────────────────┐│         │
                                                │  │   代码审查     ││         │
                                                │  │   回环 ◀──────┐││         │
                                                │  └───────┬───────┘││         │
                                                │          │  不通过 ││         │
                                                │          ▼        ││         │
                                                │       合并代码    ◀┘│         │
                                                └─────────┬─────────┘         │
                                                          │                    │
                                                          ▼                    │
                                                ┌─────────────────────┐        │
                                                │       联调         │        │
                                                └─────────┬───────────┘        │
                                                          │                    │
                                                          ▼                    ▼
                                                ┌─────────────────────────────────────┐
                                                │              Bug修复回环             │
                                                │  ┌─────────────────────────────┐    │
                                                │  │                             │    │
                                                │  │  发现Bug ──▶ 修复 ──▶ 验证 │    │
                                                │  │     ▲                  │    │    │
                                                │  │     └──── 不通过 ◀─────┘    │    │
                                                │  │                             │    │
                                                │  └─────────────────────────────┘    │
                                                └──────────────────┬──────────────────┘
                                                                   │ 测试通过
                                                                   ▼
                                                ┌─────────────────────────────────────┐
                                                │              部署回环               │
                                                │  ┌─────────────────────────────┐    │
                                                │  │                             │    │
                                                │  │  部署 ──▶ 验证 ──▶ 完成?   │    │
                                                │  │   ▲              │         │    │
                                                │  │   └─── 回滚 ◀─── 失败      │    │
                                                │  │                             │    │
                                                │  └─────────────────────────────┘    │
                                                └──────────────────┬──────────────────┘
                                                                   │ 部署成功
                                                                   ▼
                                                ┌─────────────────────────────────────┐
                                                │            产品验收回环              │
                                                │  ┌─────────────────────────────┐    │
                                                │  │                             │    │
                                                │  │ 验收 ──▶ 反馈 ──▶ 新需求?  │───▶ 回到需求阶段
                                                │  │                             │    │
                                                │  └─────────────────────────────┘    │
                                                └──────────────────┬──────────────────┘
                                                                   │
                                                                   ▼
                                                            ✅ 项目完成
```

## 文档产物清单（更新版）

### 核心文档（必须产出）

| 阶段 | 文档 | 负责角色 | 路径 |
|------|------|----------|------|
| 需求 | PRD.md | 产品经理 | `docs/requirements/` |
| 设计 | ARCHITECTURE.md | 架构师 | `docs/design/` |
| 设计 | API-SPEC.yaml | 架构师 | `docs/api/` |
| 开发 | TASK-BREAKDOWN.md | 技术负责人 | `docs/dev/` |
| 开发 | FRONTEND-IMPL.md | 前端开发 | `docs/impl/` |
| 开发 | BACKEND-IMPL.md | 后端开发 | `docs/impl/` |
| 测试 | TEST-PLAN.md | 测试工程师 | `docs/test/` |
| 测试 | TEST-REPORT.md | 测试工程师 | `docs/test/` |
| 发布 | DEPLOYMENT.md | DevOps | `docs/ops/` |

### 回环文档（按需产出）

| 回环 | 文档 | 触发条件 | 路径 |
|------|------|----------|------|
| 代码审查 | PR-REVIEW.md | 每次PR | `docs/reviews/` |
| Bug修复 | BUG-TRACKING.md | 发现Bug | `docs/test/bugs/` |
| 部署回滚 | ROLLBACK.md | 部署失败 | `docs/ops/` |
| 产品验收 | UAT-RESULT.md | 发布后 | `docs/requirements/` |

## 角色协作时序

```
时间 ──────────────────────────────────────────────────────────────────────────────▶

产品经理   ████ PRD                                            ████ UAT验收
架构师          ████ 架构 ████ API规范
技术负责人           ████ 任务分解    ████ 代码审查 ████ 代码审查
前端开发                   ████████████ 开发 ████ 修复
后端开发                   ████████████ 开发 ████ 修复    (并行)
测试工程师           ████ 测试计划        ████████ 测试执行 ████ 回归
DevOps      ████ 环境                              ████ 部署 ████ 监控

           │    │      │              │            │          │
           ▼    ▼      ▼              ▼            ▼          ▼
         同步点1  同步点2          同步点3      同步点4   同步点5
         PRD批准  设计完成        代码冻结     测试通过   发布完成
```

## 文档状态流转

```
草稿(Draft) → 评审中(In Review) → 已批准(Approved) → 已实现(Implemented)
     ↑                                    │
     └──────── 需修改(Rejected) ◀─────────┘
```
