# 团队协作工作流

## 敏捷开发流程

### Sprint周期（含回环）
```
Week 1                              Week 2
┌──────────────────────────┐       ┌──────────────────────────┐
│ Sprint Planning          │       │ Development (并行)        │
│ ├─ 需求澄清              │       │ ├─ 前端开发 ─┐            │
│ ├─ 任务分解              │       │ ├─ 后端开发 ─┤ 并行       │
│ └─ 估点                  │       │ └─ 代码审查回环 ◀─────┐   │
└──────────────────────────┘       └──────────────────────┼───┘
         ↓                                  ↓             │
┌──────────────────────────┐       ┌──────────────────────┼───┐
│ Review & Retro           │       │ Testing & Release    │   │
│ ├─ Demo展示              │       │ ├─ QA测试            │   │
│ ├─ 回顾总结              │       │ ├─ Bug修复回环 ◀─────┼───┤
│ └─ 改进计划              │       │ ├─ 部署回滚回环      │   │
└──────────────────────────┘       │ └─ 发布上线          │   │
         ↑                         └──────────────────────┼───┘
         │                                                │
         └────────────── 产品验收回环 ◀───────────────────┘
```

### 每日站会模板
```markdown
## Daily Standup - [日期]

### [姓名]
- 昨天完成: 
- 今天计划:
- 遇到阻碍:
```

## 需求到上线完整流程

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│  产品经理    │────▶│  架构师      │────▶│  技术负责人  │
│  需求定义    │     │  架构设计    │     │  任务分配    │
└─────────────┘     └─────────────┘     └─────────────┘
                                              │
       ┌──────────────────────────────────────┘
       ▼
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│  前端开发    │     │  后端开发    │     │  联调测试    │
│  UI实现      │────▶│  API实现     │────▶│  集成验证    │
└─────────────┘     └─────────────┘     └─────────────┘
                                              │
       ┌──────────────────────────────────────┘
       ▼
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│  测试工程师  │────▶│  DevOps     │────▶│  发布上线    │
│  质量验证    │     │  部署准备    │     │  监控运维    │
└─────────────┘     └─────────────┘     └─────────────┘
```

## 角色协作矩阵

| 交付物 | 负责(R) | 批准(A) | 咨询(C) | 知会(I) |
|--------|---------|---------|---------|---------|
| PRD文档 | 产品经理 | 架构师 | 技术负责人 | 开发团队 |
| 架构设计 | 架构师 | 技术负责人 | 产品经理 | DevOps |
| API设计 | 后端开发 | 技术负责人 | 前端开发 | 测试 |
| UI实现 | 前端开发 | 技术负责人 | 产品经理 | 测试 |
| 测试报告 | 测试工程师 | 产品经理 | 开发团队 | DevOps |
| 部署上线 | DevOps | 技术负责人 | 开发团队 | 产品经理 |

## 代码协作流程

### Git分支策略
```
main ─────●───────────────●───────────────●────▶ 生产
           \             /               /
develop ────●───●───●───●───●───●───●───●──────▶ 开发
             \   \       /   /
feature/xxx ──●───●─────●   /
                   \       /
feature/yyy ────────●─────●
```

### Pull Request流程（含代码审查回环）
```
┌─────────────────────────────────────────────────────────────┐
│                    代码审查回环                              │
└─────────────────────────────────────────────────────────────┘

开发提交PR ──▶ CI检查 ──▶ 通过? ──▶ 技术负责人审查 ──▶ 通过?
                          │                              │
                          ▼ 否                           ▼ 否
                       修复CI问题                     修复审查意见
                          │                              │
                          └──────────▶ 重新提交 ◀────────┘
                                          │
                                          ▼
                                      合并到develop
```

```markdown
## PR检查清单

### 提交前
- [ ] 本地测试通过
- [ ] 代码符合规范
- [ ] 提交信息清晰

### 审查时
- [ ] 至少1位同事审查
- [ ] CI流水线通过
- [ ] 无合并冲突

### 审查不通过时
- [ ] 记录审查意见到PR-REVIEW.md
- [ ] 开发修复问题
- [ ] 重新请求审查

### 合并后
- [ ] 删除功能分支
- [ ] 更新任务状态
- [ ] 通知相关方
```

## Bug修复回环

```
┌─────────────────────────────────────────────────────────────┐
│                    Bug修复回环                               │
└─────────────────────────────────────────────────────────────┘

测试发现Bug ──▶ 创建Bug报告 ──▶ 指派开发 ──▶ 开发修复 ──▶ 测试验证
     │              │                             │            │
     │              ▼                             │            ▼
     │       BUG-TRACKING.md                      │       验证通过?
     │              │                             │         │    │
     │              │                             │         ▼    ▼ 否
     │              │                             │      关闭Bug  │
     │              │                             │               │
     │              └─────────────────────────────┴───────────────┘
     │                           重新打开Bug
     │
     ▼
所有Critical/Major Bug关闭 ──▶ 生成TEST-REPORT.md ──▶ 可发布
```

### Bug状态流转
```
新建(New) → 确认(Confirmed) → 修复中(In Progress) → 待验证(Ready for Test)
     │                              ↑                        │
     │                              │                        ▼
     └──▶ 不是Bug(Won't Fix)        └─────── 重新打开 ◀─── 验证失败
                                                             │
                                                             ▼
                                                     验证通过 → 关闭(Closed)
```

## 故障响应流程

### 响应等级
| 等级 | 定义 | 响应时间 | 修复时间 |
|------|------|----------|----------|
| P0 | 系统不可用 | 5分钟 | 1小时 |
| P1 | 核心功能受损 | 15分钟 | 4小时 |
| P2 | 非核心功能受损 | 1小时 | 24小时 |
| P3 | 轻微问题 | 4小时 | 下个迭代 |

### 故障处理流程
```
发现故障 → 评估影响 → 通知团队 → 定位问题 → 修复上线 → 事后复盘
    ↓          ↓          ↓          ↓          ↓          ↓
  监控告警   确定等级   群组通知   日志分析   紧急发布   编写报告
```

### 事后复盘模板
```markdown
## 故障复盘报告

### 基本信息
- 故障时间: 
- 影响范围: 
- 持续时长: 

### 时间线
| 时间 | 事件 | 操作人 |
|------|------|--------|
|      |      |        |

### 根因分析
使用5 Why分析法:
1. Why: 
2. Why: 
3. Why: 
4. Why: 
5. Why (根因): 

### 改进措施
| 措施 | 负责人 | 截止日期 |
|------|--------|----------|
|      |        |          |
```

## 发布流程

### 发布检查清单
```markdown
## Release Checklist v[版本号]

### 发布前
- [ ] 所有功能开发完成
- [ ] 代码审查全部通过
- [ ] QA测试全部通过
- [ ] 性能测试符合预期
- [ ] 安全扫描无高危漏洞
- [ ] 文档更新完成

### 发布中
- [ ] 数据库迁移脚本就绪
- [ ] 配置变更已准备
- [ ] 回滚方案已确认
- [ ] 监控告警已配置
- [ ] 通知用户/客户

### 发布后
- [ ] 功能验证通过
- [ ] 监控指标正常
- [ ] 用户反馈跟踪
- [ ] 发布总结文档
```

### 灰度发布策略
```
阶段1: 1% 流量 (内部用户)
   ↓ 观察24小时
阶段2: 5% 流量
   ↓ 观察24小时
阶段3: 20% 流量
   ↓ 观察48小时
阶段4: 50% 流量
   ↓ 观察24小时
阶段5: 100% 全量发布
```

## 沟通机制

### 会议节奏
| 会议 | 频率 | 参与者 | 时长 |
|------|------|--------|------|
| 每日站会 | 每天 | 开发团队 | 15分钟 |
| 需求评审 | 按需 | 全员 | 1小时 |
| 技术评审 | 按需 | 技术团队 | 1小时 |
| Sprint回顾 | 每2周 | 全员 | 1小时 |

### 异步沟通规范
- **紧急问题**: 即时通讯 + 电话
- **一般问题**: 即时通讯群组
- **技术讨论**: 文档评论或Issue
- **正式决策**: 邮件或文档存档
